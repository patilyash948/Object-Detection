
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Object Detection Suite</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }
  </style>
</head>
<body className="bg-gray-50 min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    // Navbar Component
    const Navbar = ({ setPage, activePage }) => (
      <nav className="gradient-bg p-4 text-white shadow-xl">
        <div className="container mx-auto flex flex-col md:flex-row justify-between items-center">
          <div className="flex items-center mb-4 md:mb-0">
            <svg className="w-8 h-8 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path>
            </svg>
            <h1 className="text-2xl font-bold tracking-tight">VisionAI Suite</h1>
          </div>
          <div className="flex space-x-1 md:space-x-4">
            {['home', 'detection', 'dashboard', 'models', 'settings'].map(page => (
              <button 
                key={page}
                onClick={() => setPage(page)} 
                className={`relative px-3 py-2 rounded-md text-sm font-medium transition-all duration-300 group
                  ${activePage === page ? 'bg-white/20' : 'hover:bg-white/10'}`}
              >
                <span className="capitalize flex items-center">
                  {page === 'home' && (
                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                    </svg>
                  )}
                  {page === 'detection' && (
                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                  )}
                  {page === 'dashboard' && (
                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                  )}
                  {page === 'models' && (
                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                  )}
                  {page === 'settings' && (
                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                  )}
                  {page}
                </span>
                <span className={`absolute bottom-0 left-0 w-full h-0.5 bg-white transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 ${activePage === page ? 'scale-x-100' : ''}`}></span>
              </button>
            ))}
          </div>
        </div>
      </nav>
    );

    // Home Component
    const Home = ({ setPage }) => (
      <div className="container mx-auto p-6">
        <div className="text-center mb-12">
          <h2 className="text-4xl font-bold text-gray-800 mb-4">VisionAI Detection Suite</h2>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">Advanced object detection, custom model training, and comprehensive analytics in one powerful platform.</p>
        </div>
        
        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
          {[
            {
              title: "Real-time Detection",
              icon: (
                <svg className="w-10 h-10 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
              ),
              description: "Detect objects in real-time using your webcam or uploaded images with customizable confidence thresholds.",
              action: () => setPage('detection')
            },
            {
              title: "Model Training",
              icon: (
                <svg className="w-10 h-10 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                </svg>
              ),
              description: "Train custom models with your own labeled datasets and evaluate their performance.",
              action: () => setPage('detection')
            },
            {
              title: "Data Analytics",
              icon: (
                <svg className="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
              ),
              description: "Visualize detection statistics and model performance with interactive charts.",
              action: () => setPage('dashboard')
            }
          ].map((feature, index) => (
            <div 
              key={index} 
              onClick={feature.action}
              className="card-hover bg-white p-6 rounded-xl shadow-md cursor-pointer hover:shadow-lg"
            >
              <div className="flex justify-center mb-4">
                {feature.icon}
              </div>
              <h3 className="text-xl font-semibold text-center mb-3 text-gray-800">{feature.title}</h3>
              <p className="text-gray-600 text-center">{feature.description}</p>
            </div>
          ))}
        </div>
      </div>
    );

    // Detection Component
    const Detection = ({ detections, setDetections, stats, setStats }) => {
      const videoRef = React.useRef(null);
      const canvasRef = React.useRef(null);
      const [isStreaming, setIsStreaming] = React.useState(false);
      const [uploadedImages, setUploadedImages] = React.useState([]);
      const [okImages, setOkImages] = React.useState([]);
      const [notOkImages, setNotOkImages] = React.useState([]);
      const [trainingProgress, setTrainingProgress] = React.useState(0);
      const [accuracy, setAccuracy] = React.useState(null);
      const [model, setModel] = React.useState(null);
      const [testImage, setTestImage] = React.useState(null);
      const [prediction, setPrediction] = React.useState(null);
      const [activeTab, setActiveTab] = React.useState('detection');
      const [savedModels, setSavedModels] = React.useState([]);
      const [selectedModel, setSelectedModel] = React.useState(null);
      const [modelImages, setModelImages] = React.useState([]);

      const startStream = async () => {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
          if (videoRef.current) {
            videoRef.current.srcObject = stream;
            setIsStreaming(true);
            processFrames();
          }
        } catch (err) {
          alert('Could not access the camera. Please make sure you have granted camera permissions.');
          console.error(err);
        }
      };

      const stopStream = () => {
        if (videoRef.current && videoRef.current.srcObject) {
          videoRef.current.srcObject.getTracks().forEach(track => track.stop());
          setIsStreaming(false);
        }
      };

      const processFrames = async () => {
        const video = videoRef.current;
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');

        const process = async () => {
          if (!isStreaming) return;
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

          const imageData = canvas.toDataURL('image/jpeg');
          const base64Data = imageData.split(',')[1];

          try {
            const response = await fetch('http://localhost:8000/detect', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ image: base64Data })
            });
            const data = await response.json();
            
            setDetections(data.detections);
            updateStats(data.detections);
            drawDetections(ctx, data.detections);
          } catch (err) {
            console.error('Detection error:', err);
          }

          requestAnimationFrame(process);
        };
        process();
      };

      const drawDetections = (ctx, detections) => {
        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        ctx.drawImage(videoRef.current, 0, 0, ctx.canvas.width, ctx.canvas.height);
        detections.forEach(det => {
          const [x, y, w, h] = det.bbox;
          ctx.strokeStyle = '#3B82F6';
          ctx.lineWidth = 3;
          ctx.strokeRect(x, y, w, h);
          ctx.fillStyle = '#1E40AF';
          ctx.font = '16px Arial';
          ctx.fillText(`${det.class} (${(det.confidence * 100).toFixed(1)}%)`, x, y - 5);
        });
      };

      const updateStats = (detections) => {
        const newStats = { total: stats.total + detections.length, classes: { ...stats.classes } };
        detections.forEach(det => {
          newStats.classes[det.class] = (newStats.classes[det.class] || 0) + 1;
        });
        setStats(newStats);
      };

      const handleImageUpload = (e) => {
        const files = Array.from(e.target.files).slice(0, 300);
        const newImages = files.map(file => ({
          id: Date.now() + Math.random().toString(36).substr(2, 9),
          file,
          url: URL.createObjectURL(file),
          label: null
        }));
        setUploadedImages(prev => [...prev, ...newImages].slice(0, 300));
      };

      const labelImage = (index, isOK) => {
        setUploadedImages(prev => {
          const newImages = [...prev];
          const img = newImages[index];
          img.label = isOK;
          if (isOK) {
            setOkImages(prevOk => [...prevOk, img]);
          } else {
            setNotOkImages(prevNotOk => [...prevNotOk, img]);
          }
          newImages.splice(index, 1);
          return newImages;
        });
      };

      const trainModel = async () => {
        const labeledImages = [...okImages, ...notOkImages];
        if (labeledImages.length < 2) {
          alert('Please label at least 2 images');
          return;
        }

        setTrainingProgress(0);
        setAccuracy(null);

        try {
          const tfModel = tf.sequential();
          tfModel.add(tf.layers.conv2d({
            inputShape: [64, 64, 3],
            filters: 16,
            kernelSize: 3,
            activation: 'relu'
          }));
          tfModel.add(tf.layers.maxPooling2d({ poolSize: 2 }));
          tfModel.add(tf.layers.flatten());
          tfModel.add(tf.layers.dense({ units: 32, activation: 'relu' }));
          tfModel.add(tf.layers.dense({ units: 1, activation: 'sigmoid' }));
          tfModel.compile({
            optimizer: 'adam',
            loss: 'binaryCrossentropy',
            metrics: ['accuracy']
          });

          const xs = [];
          const ys = [];
          for (const img of labeledImages) {
            const image = new Image();
            image.src = img.url;
            await new Promise(resolve => image.onload = resolve);
            const tensor = tf.browser.fromPixels(image)
              .resizeNearestNeighbor([64, 64])
              .toFloat()
              .div(tf.scalar(255))
              .expandDims();
            xs.push(tensor);
            ys.push(img.label ? 1 : 0);
          }

          const xTensor = tf.concat(xs);
          const yTensor = tf.tensor1d(ys);

          await tfModel.fit(xTensor, yTensor, {
            epochs: 10,
            batchSize: 32,
            callbacks: {
              onEpochEnd: (epoch, logs) => {
                setTrainingProgress(((epoch + 1) / 10) * 100);
                setAccuracy(logs.acc * 100);
              }
            }
          });

          setModel(tfModel);
          setTrainingProgress(100);
          alert('Model training completed successfully!');
        } catch (err) {
          console.error('Training error:', err);
          alert('An error occurred during training. Please check the console for details.');
        }
      };

      const saveModel = async () => {
        if (!model) {
          alert('No model trained yet');
          return;
        }
        
        try {
          const modelName = prompt('Enter a name for your model:', `model-${new Date().toISOString().slice(0, 10)}`);
          if (!modelName) return;
          
          // Save model to local storage (simplified - in real app you'd save to IndexedDB)
          const modelData = {
            name: modelName,
            date: new Date().toISOString(),
            accuracy: accuracy,
            images: [...okImages, ...notOkImages].map(img => ({
              url: img.url,
              label: img.label ? 'OK' : 'Not OK'
            }))
          };
          
          const saved = JSON.parse(localStorage.getItem('savedModels') || '[]');
          saved.push(modelData);
          localStorage.setItem('savedModels', JSON.stringify(saved));
          setSavedModels(saved);
          
          alert(`Model "${modelName}" saved successfully!`);
        } catch (err) {
          console.error('Save error:', err);
          alert('Failed to save model');
        }
      };

      const loadSavedModels = () => {
        const saved = JSON.parse(localStorage.getItem('savedModels') || '[]');
        setSavedModels(saved);
      };

      const loadModelImages = (model) => {
        setSelectedModel(model);
        setModelImages(model.images);
      };

      const deleteModel = (index) => {
        if (confirm('Are you sure you want to delete this model?')) {
          const saved = JSON.parse(localStorage.getItem('savedModels') || '[]');
          saved.splice(index, 1);
          localStorage.setItem('savedModels', JSON.stringify(saved));
          setSavedModels(saved);
          if (selectedModel && savedModels[index] === selectedModel) {
            setSelectedModel(null);
            setModelImages([]);
          }
        }
      };

      const updateModelImageLabel = (index, isOK) => {
        setModelImages(prev => {
          const newImages = [...prev];
          newImages[index].label = isOK ? 'OK' : 'Not OK';
          return newImages;
        });
        
        // Update in saved models
        const saved = JSON.parse(localStorage.getItem('savedModels') || '[]');
        const modelIndex = saved.findIndex(m => m.name === selectedModel.name);
        if (modelIndex !== -1) {
          saved[modelIndex].images[index].label = isOK ? 'OK' : 'Not OK';
          localStorage.setItem('savedModels', JSON.stringify(saved));
          setSavedModels(saved);
        }
      };

      const deleteModelImage = (index) => {
        if (confirm('Are you sure you want to delete this image from the model?')) {
          setModelImages(prev => {
            const newImages = [...prev];
            newImages.splice(index, 1);
            return newImages;
          });
          
          // Update in saved models
          const saved = JSON.parse(localStorage.getItem('savedModels') || '[]');
          const modelIndex = saved.findIndex(m => m.name === selectedModel.name);
          if (modelIndex !== -1) {
            saved[modelIndex].images.splice(index, 1);
            localStorage.setItem('savedModels', JSON.stringify(saved));
            setSavedModels(saved);
          }
        }
      };

      const downloadClassifications = () => {
        const classifications = {
          okImages: okImages.map(img => ({ url: img.url, label: 'OK' })),
          notOkImages: notOkImages.map(img => ({ url: img.url, label: 'Not OK' }))
        };
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(classifications));
        const downloadAnchor = document.createElement('a');
        downloadAnchor.setAttribute("href", dataStr);
        downloadAnchor.setAttribute("download", "classifications.json");
        document.body.appendChild(downloadAnchor);
        downloadAnchor.click();
        downloadAnchor.remove();
      };

      const resetTraining = () => {
        if (confirm('Are you sure you want to reset all training data?')) {
          setUploadedImages([]);
          setOkImages([]);
          setNotOkImages([]);
          setTrainingProgress(0);
          setAccuracy(null);
          setModel(null);
          setTestImage(null);
          setPrediction(null);
        }
      };

      const handleTestImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          setTestImage(URL.createObjectURL(file));
          setPrediction(null);
        }
      };

      const predictImage = async () => {
        if (!model || !testImage) {
          alert('Please train a model and upload a test image first');
          return;
        }

        try {
          const image = new Image();
          image.src = testImage;
          await new Promise(resolve => image.onload = resolve);
          
          const tensor = tf.browser.fromPixels(image)
            .resizeNearestNeighbor([64, 64])
            .toFloat()
            .div(tf.scalar(255))
            .expandDims();

          const pred = model.predict(tensor);
          const score = pred.dataSync()[0];
          setPrediction(score > 0.5 ? 'OK' : 'Not OK');
        } catch (err) {
          console.error('Prediction error:', err);
          alert('An error occurred during prediction');
        }
      };

      React.useEffect(() => {
        if (activeTab === 'models') {
          loadSavedModels();
        }
      }, [activeTab]);

      return (
        <div className="container mx-auto p-4">
          <div className="flex justify-between items-center mb-6">
            <h2 className="text-2xl font-bold text-gray-800">Detection & Training</h2>
            <div className="flex space-x-2 bg-gray-100 p-1 rounded-lg">
              {['detection', 'training', 'models'].map(tab => (
                <button
                  key={tab}
                  onClick={() => setActiveTab(tab)}
                  className={`px-4 py-2 rounded-md text-sm font-medium capitalize ${activeTab === tab ? 'bg-white shadow' : 'text-gray-600 hover:bg-gray-200'}`}
                >
                  {tab}
                </button>
              ))}
            </div>
          </div>

          {activeTab === 'detection' && (
            <>
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div className="bg-white rounded-xl shadow-md overflow-hidden">
                  <div className="relative">
                    <video ref={videoRef} className="hidden" autoPlay playsInline />
                    <canvas ref={canvasRef} className="w-full h-auto" />
                    <div className="absolute bottom-4 left-0 right-0 flex justify-center gap-4">
                      <button 
                        onClick={startStream} 
                        disabled={isStreaming}
                        className={`px-4 py-2 rounded-full shadow-md flex items-center ${isStreaming ? 'bg-gray-400' : 'bg-blue-500 hover:bg-blue-600 text-white'}`}
                      >
                        <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Start
                      </button>
                      <button 
                        onClick={stopStream} 
                        disabled={!isStreaming}
                        className={`px-4 py-2 rounded-full shadow-md flex items-center ${!isStreaming ? 'bg-gray-400' : 'bg-red-500 hover:bg-red-600 text-white'}`}
                      >
                        <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"></path>
                        </svg>
                        Stop
                      </button>
                    </div>
                  </div>
                </div>
                <div className="bg-white p-6 rounded-xl shadow-md">
                  <h3 className="text-lg font-semibold mb-4 text-gray-800">Detection Results</h3>
                  {detections.length > 0 ? (
                    <ul className="space-y-2">
                      {detections.map((det, i) => (
                        <li key={i} className="flex justify-between items-center p-2 hover:bg-gray-50 rounded">
                          <span className="font-medium">{det.class}</span>
                          <span className="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-semibold">
                            {(det.confidence * 100).toFixed(1)}%
                          </span>
                        </li>
                      ))}
                    </ul>
                  ) : (
                    <p className="text-gray-500 italic">No detections yet. Start the stream to begin detection.</p>
                  )}
                </div>
              </div>
            </>
          )}

          {activeTab === 'training' && (
            <>
              <div className="bg-white p-6 rounded-xl shadow-md mb-6">
                <h3 className="text-lg font-semibold mb-4 text-gray-800">Dataset Preparation</h3>
                <div className="mb-6">
                  <label className="block mb-2 text-sm font-medium text-gray-700">Upload Images (Max 300)</label>
                  <div className="flex items-center">
                    <label className="cursor-pointer bg-blue-50 hover:bg-blue-100 text-blue-700 px-4 py-2 rounded-lg border border-blue-200 flex items-center">
                      <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                      </svg>
                      Choose Files
                      <input type="file" multiple accept="image/*" onChange={handleImageUpload} className="hidden" />
                    </label>
                    <span className="ml-4 text-sm text-gray-500">{uploadedImages.length + okImages.length + notOkImages.length} / 300 images</span>
                  </div>
                </div>

                <div className="mb-6">
                  <h4 className="text-sm font-medium text-gray-700 mb-2">Unlabeled Images</h4>
                  {uploadedImages.length > 0 ? (
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 max-h-96 overflow-y-auto scrollbar-thin p-2">
                      {uploadedImages.map((img, index) => (
                        <div key={img.id} className="border rounded-lg overflow-hidden relative group">
                          <img src={img.url} alt="upload" className="w-full h-32 object-cover" />
                          <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                            <div className="flex space-x-2">
                              <button 
                                onClick={() => labelImage(index, true)} 
                                className="p-2 bg-green-500 rounded-full hover:bg-green-600 text-white"
                                title="Mark as OK"
                              >
                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                              </button>
                              <button 
                                onClick={() => labelImage(index, false)} 
                                className="p-2 bg-red-500 rounded-full hover:bg-red-600 text-white"
                                title="Mark as Not OK"
                              >
                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                              </button>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <p className="text-gray-500 italic">No unlabeled images. Upload some images to begin labeling.</p>
                  )}
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <h4 className="text-sm font-medium text-gray-700 mb-2">OK Images ({okImages.length})</h4>
                    {okImages.length > 0 ? (
                      <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-3 gap-2 max-h-64 overflow-y-auto scrollbar-thin p-2">
                        {okImages.map((img, index) => (
                          <img key={img.id} src={img.url} alt="ok" className="w-full h-24 object-cover rounded border-2 border-green-500" />
                        ))}
                      </div>
                    ) : (
                      <p className="text-gray-500 italic">No OK images yet.</p>
                    )}
                  </div>
                  <div>
                    <h4 className="text-sm font-medium text-gray-700 mb-2">Not OK Images ({notOkImages.length})</h4>
                    {notOkImages.length > 0 ? (
                      <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-3 gap-2 max-h-64 overflow-y-auto scrollbar-thin p-2">
                        {notOkImages.map((img, index) => (
                          <img key={img.id} src={img.url} alt="not ok" className="w-full h-24 object-cover rounded border-2 border-red-500" />
                        ))}
                      </div>
                    ) : (
                      <p className="text-gray-500 italic">No Not OK images yet.</p>
                    )}
                  </div>
                </div>
              </div>

              <div className="bg-white p-6 rounded-xl shadow-md mb-6">
                <h3 className="text-lg font-semibold mb-4 text-gray-800">Model Training</h3>
                <div className="flex flex-wrap gap-4 mb-6">
                  <button 
                    onClick={trainModel} 
                    disabled={okImages.length + notOkImages.length < 2}
                    className={`px-4 py-2 rounded-lg flex items-center ${okImages.length + notOkImages.length < 2 ? 'bg-gray-300 cursor-not-allowed' : 'bg-purple-500 hover:bg-purple-600 text-white'}`}
                  >
                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                    Train Model
                  </button>
                  <button 
                    onClick={saveModel} 
                    disabled={!model}
                    className={`px-4 py-2 rounded-lg flex items-center ${!model ? 'bg-gray-300 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600 text-white'}`}
                  >
                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                    </svg>
                    Save Model
                  </button>
                  <button 
                    onClick={downloadClassifications} 
                    disabled={okImages.length + notOkImages.length === 0}
                    className={`px-4 py-2 rounded-lg flex items-center ${okImages.length + notOkImages.length === 0 ? 'bg-gray-300 cursor-not-allowed' : 'bg-green-500 hover:bg-green-600 text-white'}`}
                  >
                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Export Data
                  </button>
                  <button 
                    onClick={resetTraining} 
                    disabled={uploadedImages.length + okImages.length + notOkImages.length === 0}
                    className={`px-4 py-2 rounded-lg flex items-center ${uploadedImages.length + okImages.length + notOkImages.length === 0 ? 'bg-gray-300 cursor-not-allowed' : 'bg-red-500 hover:bg-red-600 text-white'}`}
                  >
                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    Reset All
                  </button>
                </div>

                {trainingProgress > 0 && (
                  <div className="space-y-4">
                    <div>
                      <div className="flex justify-between mb-1">
                        <span className="text-sm font-medium text-gray-700">Training Progress</span>
                        <span className="text-sm font-medium text-gray-700">{trainingProgress.toFixed(1)}%</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-2.5">
                        <div 
                          className="bg-gradient-to-r from-blue-500 to-purple-600 h-2.5 rounded-full" 
                          style={{ width: `${trainingProgress}%` }}
                        ></div>
                      </div>
                    </div>
                    {accuracy !== null && (
                      <div className="bg-blue-50 p-3 rounded-lg">
                        <div className="flex justify-between items-center">
                          <span className="text-sm font-medium text-blue-800">Model Accuracy</span>
                          <span className="text-sm font-bold text-blue-800">{accuracy.toFixed(1)}%</span>
                        </div>
                      </div>
                    )}
                  </div>
                )}
              </div>

              <div className="bg-white p-6 rounded-xl shadow-md">
                <h3 className="text-lg font-semibold mb-4 text-gray-800">Model Testing</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label className="block mb-2 text-sm font-medium text-gray-700">Upload Test Image</label>
                    <div className="flex items-center">
                      <label className="cursor-pointer bg-gray-50 hover:bg-gray-100 text-gray-700 px-4 py-2 rounded-lg border border-gray-200 flex items-center">
                        <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        Choose Image
                        <input type="file" accept="image/*" onChange={handleTestImageUpload} className="hidden" />
                      </label>
                    </div>
                    {testImage && (
                      <div className="mt-4">
                        <img src={testImage} alt="test" className="w-full h-64 object-contain rounded-lg border" />
                      </div>
                    )}
                  </div>
                  <div>
                    <div className="h-full flex flex-col justify-between">
                      <div>
                        <h4 className="text-sm font-medium text-gray-700 mb-2">Prediction</h4>
                        {prediction ? (
                          <div className={`p-4 rounded-lg ${prediction === 'OK' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'}`}>
                            <div className="flex items-center">
                              <svg className="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d={prediction === 'OK' ? "M5 13l4 4L19 7" : "M6 18L18 6M6 6l12 12"}></path>
                              </svg>
                              <span className="font-bold text-lg">This image is {prediction}</span>
                            </div>
                          </div>
                        ) : (
                          <div className="p-4 rounded-lg bg-gray-50 text-gray-500">
                            Upload an image and click "Predict" to see results
                          </div>
                        )}
                      </div>
                      <button 
                        onClick={predictImage} 
                        disabled={!model || !testImage}
                        className={`mt-4 px-4 py-2 rounded-lg flex items-center justify-center w-full ${!model || !testImage ? 'bg-gray-300 cursor-not-allowed' : 'bg-green-500 hover:bg-green-600 text-white'}`}
                      >
                        <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Predict
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </>
          )}

          {activeTab === 'models' && (
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <div className="bg-white p-6 rounded-xl shadow-md lg:col-span-1">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-lg font-semibold text-gray-800">Saved Models</h3>
                  <button 
                    onClick={loadSavedModels}
                    className="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full"
                    title="Refresh models"
                  >
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                  </button>
                </div>
                {savedModels.length > 0 ? (
                  <div className="space-y-3 max-h-[calc(100vh-300px)] overflow-y-auto scrollbar-thin">
                    {savedModels.map((model, index) => (
                      <div 
                        key={index} 
                        onClick={() => loadModelImages(model)}
                        className={`p-4 border rounded-lg cursor-pointer transition-all ${selectedModel?.name === model.name ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-blue-300 hover:bg-blue-50/50'}`}
                      >
                        <div className="flex justify-between items-start">
                          <div>
                            <h4 className="font-medium text-gray-800">{model.name}</h4>
                            <p className="text-sm text-gray-500">{new Date(model.date).toLocaleString()}</p>
                          </div>
                          <button 
                            onClick={(e) => {
                              e.stopPropagation();
                              deleteModel(index);
                            }}
                            className="text-gray-400 hover:text-red-500 p-1"
                            title="Delete model"
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                          </button>
                        </div>
                        <div className="mt-2 flex justify-between items-center">
                          <span className="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded-full">
                            {model.images.length} images
                          </span>
                          {model.accuracy && (
                            <span className="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full">
                              Accuracy: {model.accuracy.toFixed(1)}%
                            </span>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                ) : (
                  <div className="text-center py-8">
                    <svg className="w-12 h-12 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    <p className="mt-2 text-gray-500">No saved models yet</p>
                  </div>
                )}
              </div>
              
              <div className="bg-white p-6 rounded-xl shadow-md lg:col-span-2">
                {selectedModel ? (
                  <>
                    <div className="flex justify-between items-center mb-4">
                      <h3 className="text-lg font-semibold text-gray-800">{selectedModel.name}</h3>
                      <div className="flex items-center space-x-2">
                        <span className="text-sm text-gray-500">{modelImages.length} images</span>
                        {selectedModel.accuracy && (
                          <span className="text-sm px-2 py-1 bg-blue-100 text-blue-800 rounded-full">
                            Accuracy: {selectedModel.accuracy.toFixed(1)}%
                          </span>
                        )}
                      </div>
                    </div>
                    <p className="text-sm text-gray-500 mb-6">Saved on {new Date(selectedModel.date).toLocaleString()}</p>
                    
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 max-h-[calc(100vh-300px)] overflow-y-auto scrollbar-thin p-2">
                      {modelImages.map((img, index) => (
                        <div key={index} className="relative group">
                          <img 
                            src={img.url} 
                            alt="model" 
                            className={`w-full h-32 object-cover rounded-lg border-2 ${img.label === 'OK' ? 'border-green-500' : 'border-red-500'}`}
                          />
                          <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 flex flex-col justify-between p-2 opacity-0 group-hover:opacity-100">
                            <button 
                              onClick={() => deleteModelImage(index)}
                              className="self-end p-1 bg-white rounded-full text-red-500 hover:bg-red-500 hover:text-white"
                              title="Delete image"
                            >
                              <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path>
                              </svg>
                            </button>
                            <div className="flex justify-center space-x-2">
                              <button 
                                onClick={() => updateModelImageLabel(index, true)}
                                className={`p-1 rounded-full ${img.label === 'OK' ? 'bg-green-500 text-white' : 'bg-white text-green-500 hover:bg-green-500 hover:text-white'}`}
                                title="Mark as OK"
                              >
                                <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                              </button>
                              <button 
                                onClick={() => updateModelImageLabel(index, false)}
                                className={`p-1 rounded-full ${img.label === 'Not OK' ? 'bg-red-500 text-white' : 'bg-white text-red-500 hover:bg-red-500 hover:text-white'}`}
                                title="Mark as Not OK"
                              >
                                <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                              </button>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </>
                ) : (
                  <div className="text-center py-12">
                    <svg className="w-16 h-16 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <h3 className="mt-4 text-lg font-medium text-gray-700">No Model Selected</h3>
                    <p className="mt-1 text-gray-500">Select a model from the list to view its images</p>
                  </div>
                )}
              </div>
            </div>
          )}
        </div>
      );
    };

    // Dashboard Component
    const Dashboard = ({ stats }) => {
      const chartRef = React.useRef(null);
      const [chart, setChart] = React.useState(null);

      React.useEffect(() => {
        if (chartRef.current && !chart) {
          const ctx = chartRef.current.getContext('2d');
          const newChart = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: Object.keys(stats.classes),
              datasets: [{
                label: 'Objects Detected',
                data: Object.values(stats.classes),
                backgroundColor: 'rgba(79, 70, 229, 0.7)',
                borderColor: 'rgba(79, 70, 229, 1)',
                borderWidth: 1
              }]
            },
            options: { 
              responsive: true,
              plugins: {
                legend: {
                  display: false
                },
                tooltip: {
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  titleFont: { size: 14, weight: 'bold' },
                  bodyFont: { size: 12 },
                  padding: 12,
                  cornerRadius: 8
                }
              },
              scales: { 
                y: { 
                  beginAtZero: true,
                  grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                  },
                  ticks: {
                    stepSize: 1
                  }
                },
                x: {
                  grid: {
                    display: false
                  }
                }
              } 
            }
          });
          setChart(newChart);
        }
        return () => chart && chart.destroy();
      }, [stats]);

      return (
        <div className="container mx-auto p-6">
          <div className="bg-white rounded-xl shadow-md overflow-hidden">
            <div className="p-6">
              <h2 className="text-2xl font-bold text-gray-800 mb-2">Detection Analytics</h2>
              <p className="text-gray-600 mb-6">Visual overview of all detected objects and their frequencies.</p>
              
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div className="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-100">
                  <div className="flex items-center">
                    <div className="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
                      <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                      </svg>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Total Detections</p>
                      <p className="text-2xl font-bold text-gray-800">{stats.total}</p>
                    </div>
                  </div>
                </div>
                <div className="bg-gradient-to-r from-purple-50 to-indigo-50 p-4 rounded-lg border border-purple-100">
                  <div className="flex items-center">
                    <div className="p-3 rounded-full bg-purple-100 text-purple-600 mr-4">
                      <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                      </svg>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Unique Classes</p>
                      <p className="text-2xl font-bold text-gray-800">{Object.keys(stats.classes).length}</p>
                    </div>
                  </div>
                </div>
                <div className="bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg border border-indigo-100">
                  <div className="flex items-center">
                    <div className="p-3 rounded-full bg-indigo-100 text-indigo-600 mr-4">
                      <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Most Frequent</p>
                      <p className="text-2xl font-bold text-gray-800">
                        {Object.keys(stats.classes).length > 0 ? 
                          Object.entries(stats.classes).sort((a, b) => b[1] - a[1])[0][0] : 
                          'None'}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              
              <div className="bg-white p-4 rounded-lg border border-gray-200">
                <canvas ref={chartRef} className="w-full h-96"></canvas>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // Models Component
    const Models = () => {
      return (
        <div className="container mx-auto p-6">
          <div className="bg-white rounded-xl shadow-md overflow-hidden">
            <div className="p-6">
              <h2 className="text-2xl font-bold text-gray-800 mb-6">Model Management</h2>
              <p className="text-gray-600">This functionality is now integrated into the Detection page under the "Models" tab.</p>
            </div>
          </div>
        </div>
      );
    };

    // Settings Component
    const Settings = ({ confidenceThreshold, setConfidenceThreshold }) => {
      const [apiEndpoint, setApiEndpoint] = React.useState('http://localhost:8000/detect');
      const [darkMode, setDarkMode] = React.useState(false);
      
      const toggleDarkMode = () => {
        setDarkMode(!darkMode);
        document.body.classList.toggle('dark');
      };

      return (
        <div className="container mx-auto p-6">
          <div className="bg-white rounded-xl shadow-md overflow-hidden">
            <div className="p-6">
              <h2 className="text-2xl font-bold text-gray-800 mb-6">Application Settings</h2>
              
              <div className="space-y-6">
                <div className="border-b border-gray-200 pb-6">
                  <h3 className="text-lg font-medium text-gray-800 mb-4">Detection Settings</h3>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Confidence Threshold</label>
                      <div className="flex items-center space-x-4">
                        <input 
                          type="range" 
                          min="0" 
                          max="100" 
                          value={confidenceThreshold} 
                          onChange={(e) => setConfidenceThreshold(parseInt(e.target.value))} 
                          className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                        />
                        <span className="text-sm font-medium text-gray-600 w-12">{confidenceThreshold}%</span>
                      </div>
                      <p className="mt-1 text-xs text-gray-500">Adjust the minimum confidence level for detections to be displayed.</p>
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">API Endpoint</label>
                      <input 
                        type="text" 
                        value={apiEndpoint} 
                        onChange={(e) => setApiEndpoint(e.target.value)}
                        className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                      />
                      <p className="mt-1 text-xs text-gray-500">Endpoint for the detection API service.</p>
                    </div>
                  </div>
                </div>
                
                <div className="border-b border-gray-200 pb-6">
                  <h3 className="text-lg font-medium text-gray-800 mb-4">Appearance</h3>
                  <div className="flex items-center justify-between">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Dark Mode</label>
                      <p className="text-xs text-gray-500">Toggle between light and dark theme.</p>
                    </div>
                    <button 
                      onClick={toggleDarkMode}
                      className={`relative inline-flex h-6 w-11 items-center rounded-full ${darkMode ? 'bg-blue-600' : 'bg-gray-200'}`}
                    >
                      <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition ${darkMode ? 'translate-x-6' : 'translate-x-1'}`} />
                    </button>
                  </div>
                </div>
                
                <div>
                  <h3 className="text-lg font-medium text-gray-800 mb-4">About</h3>
                  <div className="bg-gray-50 p-4 rounded-lg">
                    <p className="text-sm text-gray-600 mb-2">
                      <span className="font-medium">VisionAI Detection Suite</span> - v1.0.0
                    </p>
                    <p className="text-sm text-gray-600 mb-2">
                      A comprehensive tool for object detection, model training, and analytics.
                    </p>
                    <p className="text-sm text-gray-600">
                      Built with TensorFlow.js, React, and Chart.js
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // Main App Component
    const App = () => {
      const [page, setPage] = React.useState('home');
      const [detections, setDetections] = React.useState([]);
      const [stats, setStats] = React.useState({ total: 0, classes: {} });
      const [confidenceThreshold, setConfidenceThreshold] = React.useState(50);

      return (
        <div className="min-h-screen">
          <Navbar setPage={setPage} activePage={page} />
          <main className="pb-12">
            {page === 'home' && <Home setPage={setPage} />}
            {page === 'detection' && <Detection detections={detections} setDetections={setDetections} stats={stats} setStats={setStats} />}
            {page === 'dashboard' && <Dashboard stats={stats} />}
            {page === 'models' && <Models />}
            {page === 'settings' && <Settings confidenceThreshold={confidenceThreshold} setConfidenceThreshold={setConfidenceThreshold} />}
          </main>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
